<div ng-show="currentPage.distributionDetail">
  <div class="row">
    <h3 class="medium-12 columns">Distribution du {{currentDistribution.distributionDate | DateWithJQueryUiDatePicker}}
      ({{numberBeneficiairesPresent}} bénéficiaires présents)</h3>
  </div>

  <div class="row">
    <div class="medium-12 columns">
      <table class="table">
        <thead>
        <tr>
          <td>Code</td>
          <td>Nom</td>
          <td>Prénom</td>
          <td>Présent</td>
          <td colspan="2">Commentaire</td>
        </tr>
        <tr>
          <td colspan="6"><input type="text" ng-model="searchText" placeholder="42, Georges, Henriette, etc."/></td>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="user in beneficiaires | filter:searchBeneficiaire">
          <td>{{user.code}}</td>
          <td>{{user.lastName}}</td>
          <td>{{user.firstName}}</td>
          <td>
            <input type="checkbox" ng-model="user.isPresent" ng-change="isPresent(user)" ng-disabled="readOnly"/>
          </td>
          <td ng-hide="readOnly">
            <a id="commentsToggle" ng-show="user.comments.length > 0"><span class="ui-icon ui-icon-alert"></span>

              <div id="commentsDetail">
                <ul ng-repeat="comments in user.comments">
                  <li>{{comments}}</li>
                </ul>
              </div>
            </a>
          </td>
          <td>
            <input type="text" ng-model="user.comment" ng-change="writeComment(user.id, user.comment)"
                   ng-disabled="readOnly || !user.isPresent"/>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div ng-show="currentPage.distributionList">
  <form name="addDistributionForm">
    <div class="row">
      <div class="medium-9 columns">
        <label>
          Date
          <input type="text" ui-date="dateOptions" ui-date-format="yy-mm-dd"
                 ng-model="currentDistribution.distributionDate" ng-required="true"/>
        </label>
      </div>
      <div class="medium-3 columns">
        <label>
          Repas prévus
          <input type="text" ng-model="currentDistribution.distributionNbPlannedMeals" required/>
        </label>
      </div>
    </div>
    <div class="row">
      <div class="medium-4 columns right">
        <button ng-click="startNewDistribution()" class="button secondary expand">Commencer la distribution</button>
      </div>
    </div>
  </form>

  <div class="row">
    <h3 class="medium-12 columns">Distributions</h3>
  </div>

  <div class="row">
    <div class="medium-12 columns">
      <table class="table">
        <thead>
        <tr>
          <th>Date</th>
          <th>Repas prévus</th>
          <th>Bénéficiaires présents</th>
          <th>Commentaires</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="distribution in distributions">
          <td>{{distribution.distributionDate | DateWithJQueryUiDatePicker}}</td>
          <td>{{distribution.nbPlannedMeals}}</td>
          <td>{{distribution.nbBeneficiaires}}</td>
          <td>{{distribution.comments.length}}</td>
          <td>
            <button class="tiny button secondary expand" ng-click="loadDistribution(distribution.id, false)"
                    ng-hide="!$first">Modifier
            </button>
            <button class="tiny button secondary expand" ng-click="loadDistribution(distribution.id, true)"
                    ng-hide="$first">Afficher
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
